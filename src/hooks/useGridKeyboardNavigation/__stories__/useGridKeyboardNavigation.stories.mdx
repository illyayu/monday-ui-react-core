import { useRef, useCallback, useState, useMemo } from "react";
import { ArgsTable, Story, Canvas, Meta } from "@storybook/addon-docs";
import useGridKeyboardNavigation from "../useGridKeyboardNavigation";
import { action } from "@storybook/addon-actions";
import cx from "classnames";
import range from "lodash/range";
import "./useGridKeyboardNavigation.stories.scss";
import Button from "../../../../src/components/Button/Button";

<Meta title="Keyboard/useGridKeyboardNavigation" />

# useEventListener

- [Overview](#overview)
- [Arguments](#arguments)
- [Feedback](#feedback)

## Overview

Used for accessible keyboard navigation. Useful for components rendering items that can be navigated and selected with a keyboard.



export const ELEMENT_WIDTH_PX = 72;
export const PADDING_PX = 24;

export const ON_CLICK = action('item selected');

<Canvas>
  <Story name="Overview">
    {() => {
    const ref = useRef(null);
    const [itemsCount, setItemsCount] = useState(15);
    const [numberOfItemsInLine, setNumberOfItemsInLine] = useState(4);
    const width = useMemo(() => numberOfItemsInLine * ELEMENT_WIDTH_PX + 2 * PADDING_PX, [numberOfItemsInLine]);
    const items = useMemo(() => range(itemsCount).map(num => `${num}.`), [itemsCount]);
    const getItemByIndex = useCallback(index => items[index], [items]);
    const { activeIndex, onFocus, onBlur, onSelectionAction } = useGridKeyboardNavigation({
      ref,
      numberOfItemsInLine,
      itemsCount,
      getItemByIndex,
      onItemClicked: ON_CLICK,
    });
    const onClickByIndex = useCallback((index) => () => onSelectionAction(index), [onSelectionAction]);
    return (
      <div>
        <div className="use-grid-keyboard-nav-comp-wrapper" style={{ width }} ref={ref} tabIndex={-1} onBlur={onBlur} onFocus={onFocus}>
          {items.map((item, index) => (
            <Button key={item} onClick={onClickByIndex(index)} className={cx("use-grid-keyboard-nav-item", { "active-item": index === activeIndex })}>
              {item}
            </Button>
          ))}
        </div>
        <div className="use-grid-keyboard-nav-controls">
          <div>Items count: <input value={itemsCount} onChange={e => setItemsCount(e.target.value)} type="number" min={1}/></div>
          <div>Number of items in line: <input value={numberOfItemsInLine} onChange={e => setNumberOfItemsInLine(e.target.value)} type="number" min={1}/></div>
        </div>
      </div>
    );
}}
  </Story>
</Canvas>

<!-- ## Arguments

<FunctionArguments>
  <FunctionArgument name="options" type="Object">
    <FunctionArgument
      name="ref"
      type="React.MutableRefObject"
      description={<>A React <a href="https://reactjs.org/docs/hooks-reference.html#useref" target="_blank" rel="noopener noreferrer">ref</a> object.</>}
    />
    <FunctionArgument
      name="callback"
      type="(event: Event) => void"
      description="Callback function to execute when the event is fired."
      required
    />
    <FunctionArgument
      name="eventName"
      type="string"
      description={<>The event to listen to. See <a href="https://developer.mozilla.org/en-US/docs/Web/Events" target="_blank" rel="noopener noreferrer">a full list</a> for more info.</>}
      required
    />
    <FunctionArgument
      name="capture"
      type="boolean"
      description="Whether to capture the event before bubbling up or not."
      default="false"
    />
  </FunctionArgument>
</FunctionArguments> -->
